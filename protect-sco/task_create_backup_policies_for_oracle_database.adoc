---
permalink: protect-sco/task_create_backup_policies_for_oracle_database.html 
sidebar: sidebar 
keywords: backup policies, policies 
summary: 在使用SnapCenter 支援功能來備份Oracle資料庫資源之前、您必須先為要備份的資源或資源群組建立備份原則。備份原則是一組規則、可管理您管理、排程及保留備份的方式。您也可以指定複寫、指令碼及備份類型設定。當您想要在其他資源或資源群組上重複使用原則時、建立原則可節省時間。 
---
= 為Oracle資料庫建立備份原則
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
在使用SnapCenter 支援功能來備份Oracle資料庫資源之前、您必須先為要備份的資源或資源群組建立備份原則。備份原則是一組規則、可管理您管理、排程及保留備份的方式。您也可以指定複寫、指令碼及備份類型設定。當您想要在其他資源或資源群組上重複使用原則時、建立原則可節省時間。

*開始之前*

* 您必須已定義備份策略。
* 您必須完成安裝SnapCenter 、新增主機、探索資料庫及建立儲存系統連線等工作、準備好保護資料。
* 如果您要將快照複製到鏡像或資料保險箱次要儲存設備、 SnapCenter 管理員必須將來源和目的地磁碟區的 SVM 指派給您。
* 如果您以非 root 使用者的身分安裝外掛程式、則應該手動將執行權限指派給 prescScript 和 PostScript 目錄。
* 查看 SnapMirror 主動同步的特定先決條件和限制。如需相關資訊、請參閱 https://docs.netapp.com/us-en/ontap/smbc/considerations-limits.html#volumes["SnapMirror 主動同步的物件限制"]。


.關於這項工作
* SnapLock
+
** 如果選取「保留特定天數的備份複本」選項、則 SnapLock 保留期間必須小於或等於所述保留天數。
+
指定 Snapshot 鎖定期間可防止在保留期間到期之前刪除 Snapshot 。這可能會導致保留的快照數量超過原則中指定的數量。

+
對於 ONTAP 9.12.1 及更低版本、從 SnapLock 資料保險箱快照建立的複本作為還原的一部分、將會繼承 SnapLock 資料保險箱到期時間。儲存管理員應在 SnapLock 到期後手動清理複本。





*步驟*

. 在左側導覽窗格中、按一下*設定*。
. 在「設定」頁面中、按一下*原則*。
. 從下拉式清單中選取* Oracle Database*。
. 按一下「*新增*」。
. 在「名稱」頁面中，輸入原則名稱和詳細資料。
. 在「原則類型」頁面中，執行下列步驟：
+
.. 選擇您的儲存類型。
.. 選取原則範圍：
+
*** 如果您要*建立線上備份*、請選取*線上備份*。
+
您必須指定是否要備份所有資料檔案、控制檔及封存記錄檔、僅備份資料檔案及控制檔、或僅備份歸檔記錄檔。

*** 如果您要*建立離線備份*、請選取*離線備份*、然後選取下列其中一個選項：
+
**** 如果您想在資料庫處於掛載狀態時建立離線備份、請選取*掛載*。
**** 如果您想要將資料庫變更為關機狀態來建立離線關機備份、請選取*關機*。
+
如果您有可插拔的資料庫（PDF）、而且想要在建立備份之前儲存這些PDF的狀態、則必須選取*儲存PDB*的狀態。這可讓您在建立備份之後、將PDF恢復至原始狀態。





.. 如果要使用Oracle Recovery Manager（RMAN）對備份進行目錄編錄、請選取*使用Oracle Recovery Manager（RMAN）進行目錄備份*。
+
您可以使用GUI或SnapCenter 使用flexiCLI命令Catalog-SmBackupWithOracleRMAN、一次執行一個備份的延後目錄。

+

NOTE: 如果您想要編錄RAC資料庫的備份目錄、請確定該資料庫沒有執行其他工作。如果另一個工作正在執行中、則目錄作業會失敗、而非排入佇列。

.. 如果您想在備份後剪除歸檔記錄、請選取*備份後的Prune歸檔記錄*。
+

NOTE: 將跳過從資料庫中未設定的歸檔記錄目的地剪除的歸檔記錄。

+

IMPORTANT: 如果您使用的是Oracle Standard Edition、則可以在執行歸檔記錄備份時使用log_archive目的地和log_archive due_dest參數。

+
*** 只有在備份時選擇了歸檔記錄檔、才能刪除歸檔記錄檔。
+

NOTE: 您必須確保RAC環境中的所有節點都能存取所有歸檔記錄位置、才能成功執行刪除作業。

+
|===
| 如果您想要... | 然後... 


 a| 
刪除所有歸檔記錄
 a| 
選取*刪除所有歸檔記錄*。



 a| 
刪除較舊的歸檔記錄
 a| 
選取*刪除早於*的歸檔記錄、然後指定要在數天和數小時內刪除的歸檔記錄的存留期。



 a| 
刪除所有目的地的歸檔記錄
 a| 
選取*從所有目的地刪除歸檔記錄*。



 a| 
從備份的記錄目的地刪除歸檔記錄
 a| 
選取*從備份的目的地刪除歸檔記錄*。

|===
+
image:../media/sco_backuppolicy_prunning.gif["修剪原則"]





. 在「 Snapshot and Replication 」（快照與複寫）頁面中，執行下列步驟：
+
.. 選取*隨選*、*每小時*、*每日*、*每週*或*每月*、以指定排程頻率。
+

NOTE: 您可以在建立資源群組時、指定備份作業的排程（開始日期和結束日期）。這可讓您建立共用相同原則和備份頻率的資源群組、但可讓您為每個原則指派不同的備份排程。

+

NOTE: 如果您排定在上午2：00、則在夏令時間（Dst）期間不會觸發排程。

.. 在「資料快照保留設定」區段中，指定備份類型的保留設定，以及在「備份類型」頁面中選取的排程類型：
+
|===


| 如果您想要... | 然後... 


 a| 
保留一定數量的快照
 a| 
選取 * 要保留的複本 * ，然後指定要保留的快照數。

如果快照數量超過指定數量、則會先刪除最舊的複本、然後刪除快照。


NOTE: 最大保留值為 1018 。如果保留設定的值高於基礎ONTAP 版支援的值、則備份將會失敗。


IMPORTANT: 如果您打算啟用SnapVault 此功能、則必須將保留數設為2或更高。如果將保留計數設為 1 、則保留作業可能會失敗、因為第一個 Snapshot 是 SnapVault 關係的參考 Snapshot 、直到較新的 Snapshot 複寫到目標為止。



 a| 
將快照保留一定天數
 a| 
選取 * 保留複本 * ，然後指定您要保留快照的天數，再將其刪除。



 a| 
主要快照複本鎖定期間
 a| 
如果您要指定主要快照複本鎖定期間，請選取 * 主要快照複本鎖定期間 * ，然後選取天，月或年。

SnapLock 保留期應少於 100 年。



 a| 
次 Snapshot 複本鎖定期間
 a| 
如果您要指定次要快照複本鎖定期間，請選取 * 次要快照複本鎖定期間 * ，然後選取天，月或年。

|===
+

NOTE: 只有在您選擇歸檔記錄檔做為備份的一部分時、才能保留歸檔記錄備份。

.. 在「歸檔記錄快照保留設定」區段中，指定備份類型的保留設定，以及在「備份類型」頁面中選取的排程類型：
+
|===


| 如果您想要... | 然後... 


 a| 
保留一定數量的快照
 a| 
選取 * 要保留的複本 * ，然後指定要保留的快照數。

如果快照數量超過指定數量、則會先刪除最舊的複本、然後刪除快照。


NOTE: 最大保留值為 1018 。如果保留設定的值高於基礎ONTAP 版支援的值、則備份將會失敗。


IMPORTANT: 如果您打算啟用SnapVault 此功能、則必須將保留數設為2或更高。如果將保留計數設為 1 、則保留作業可能會失敗、因為第一個 Snapshot 是 SnapVault 關係的參考 Snapshot 、直到較新的 Snapshot 複寫到目標為止。



 a| 
將快照保留一定天數
 a| 
選取 * 保留複本 * ，然後指定您要保留快照的天數，再將其刪除。



 a| 
主要快照複本鎖定期間
 a| 
如果您要指定主要快照複本鎖定期間，請選取 * 主要快照複本鎖定期間 * ，然後選取天，月或年。

SnapLock 保留期應少於 100 年。



 a| 
次 Snapshot 複本鎖定期間
 a| 
如果您要指定次要快照複本鎖定期間，請選取 * 次要快照複本鎖定期間 * ，然後選取天，月或年。

|===
+

NOTE: 只有在您選擇歸檔記錄檔做為備份的一部分時、才能保留歸檔記錄備份。

.. 選取原則標籤。
+
根據您選取的 Snapshot 標籤、 ONTAP 會套用符合標籤的次要 Snapshot 保留原則。

+

NOTE: 如果您在建立本機Snapshot複本之後選擇*更新SnapMirror、您可以選擇性地指定次要原則標籤。不過、如果SnapVault 您在建立本機Snapshot複本*之後選擇*更新SUpdate、則應指定次要原則標籤。



. 在 [ 選取次要複寫選項 ] 區段中，選取下列其中一個或兩個次要複寫選項：
+

NOTE: 您必須為 * 次快照複本鎖定期間 * 選取次要複寫選項，才能生效。

+
|===
| 針對此欄位... | 執行此動作... 


 a| 
在建立本機 Snapshot 之後更新 SnapMirror
 a| 
選取此欄位可在另一個磁碟區（SnapMirror複寫）上建立備份集的鏡射複本。

應啟用此選項以進行 SnapMirror 主動同步。

在次要複寫期間、 SnapLock 到期時間會載入主要 SnapLock 到期時間。

按一下「拓撲」頁面中的 * 重新整理 * 按鈕、即可重新整理從 ONTAP 擷取的次要和主要 SnapLock 到期時間。



 a| 
建立本機快照後更新 SnapVault
 a| 
選取此選項以執行磁碟對磁碟備份複寫（SnapVault 還原備份）。

當 SnapLock 僅在「 SnapLock 資料保險箱」的次要 ONTAP 上設定時、按一下「拓撲」頁面中的「 * 重新整理 * 」按鈕、即可重新整理從 ONTAP 擷取的次要裝置上的鎖定期間。

如需 SnapLock Vault 的詳細資訊、請參閱 https://docs.netapp.com/us-en/ontap/snaplock/commit-snapshot-copies-worm-concept.html["將Snapshot複本提交至保存目的地上的WORM"]

請參閱。 link:../protect-sco/task_view_oracle_databse_backups_and_clones_in_the_topology_page.html["在「拓撲」頁面中檢視Oracle資料庫備份與複製"]



 a| 
重試次數錯誤
 a| 
輸入作業停止前可允許的最大複寫嘗試次數。

|===
+

NOTE: 您應該在 ONTAP 中為次要儲存設備設定 SnapMirror 保留原則、以避免達到次要儲存設備快照的上限。

. 在「指令碼」頁面中、分別輸入您要在備份作業之前或之後執行的指令碼或指令碼路徑和引數。
+
您必須將預先編寫的內容和指令碼儲存在_/var/opt/snapcenter/spl/scripts_或此路徑內的任何資料夾中。依預設、會填入_/var/opt/snapcenter/spl/scripts_路徑。如果您在此路徑中建立任何資料夾來儲存指令碼、則必須在路徑中指定這些資料夾。

+
您也可以指定指令碼逾時值。預設值為60秒。

+
利用此功能、您可以在執行pretced和postscript時、使用預先定義的環境變數。SnapCenter link:../protect-sco/predefined-environment-variables-prescript-postscript-backup.html["深入瞭解"^]

. 在「驗證」頁面中、執行下列步驟：
+
.. 選取您要執行驗證作業的備份排程。
.. 在「驗證指令碼命令」區段中、分別輸入您要在驗證作業之前或之後執行的預先記錄或PostScript路徑和引數。
+
您必須將預先編寫的內容和指令碼儲存在_/var/opt/snapcenter/spl/scripts_或此路徑內的任何資料夾中。依預設、會填入_/var/opt/snapcenter/spl/scripts_路徑。如果您在此路徑中建立任何資料夾來儲存指令碼、則必須在路徑中指定這些資料夾。

+
您也可以指定指令碼逾時值。預設值為60秒。



. 檢閱摘要、然後按一下「*完成*」。

